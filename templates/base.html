{% load static %}
<!doctype html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>{% block title %}Console{% endblock %}</title>

    <!-- Bootstrap CSS (verifique os hashes SRI em produção) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    >

    <link rel="icon" href="{% static 'img/company-logo.png' %}">

    <style>
      :root {
        --brand-purple: #6b4ce6;
        --brand-purple-600: #5e40d0;
        --bg-surface: #ffffff;
        --bg-muted: #f6f8fb;
        --text-main: #111318;
        --text-dim: #5b6573;
        --border: #e6e9f0;
        --focus-ring: rgba(107, 76, 230, 0.35);
      }

      body {
        background: var(--bg-muted);
        color: var(--text-main);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .og-navbar {
        background: var(--bg-surface);
        border-bottom: 1px solid var(--border);
      }

      .og-navbar .nav-link {
        font-size: 0.95rem;
        color: var(--text-dim);
      }

      .og-navbar .nav-link:hover,
      .og-navbar .nav-link:focus {
        color: var(--text-main);
      }

      .og-card {
        background: var(--bg-surface);
        border: 1px solid var(--border);
        border-radius: 14px;
        box-shadow: 0 6px 16px rgba(15, 23, 42, 0.04);
      }

      .btn-primary {
        --bs-btn-bg: var(--brand-purple);
        --bs-btn-border-color: var(--brand-purple);
        --bs-btn-hover-bg: var(--brand-purple-600);
        --bs-btn-hover-border-color: var(--brand-purple-600);
        --bs-btn-focus-shadow-rgb: 107, 76, 230;
      }

      .form-floating > .form-control,
      .form-floating > .form-select {
        border-radius: 10px;
        border-color: var(--border);
      }

      .form-floating > .form-control:focus,
      .form-floating > .form-select:focus {
        border-color: var(--brand-purple);
        box-shadow: 0 0 0 0.15rem var(--focus-ring);
      }

      .logo {
        height: 28px;
        width: auto;
      }

      .og-page {
        padding-top: 1.5rem;
        padding-bottom: 2rem;
        flex: 1 0 auto; /* empurra o footer para baixo */
      }

      footer.og-footer {
        flex-shrink: 0;
        border-top: 1px solid var(--border);
        background: var(--bg-surface);
        color: var(--text-dim);
        font-size: 0.85rem;
      }

      .og-footer a {
        color: inherit;
        text-decoration: none;
      }

      .og-footer a:hover {
        text-decoration: underline;
      }

      .og-alerts .alert {
        border-radius: 10px;
        padding-top: 0.6rem;
        padding-bottom: 0.6rem;
      }

      @media (max-width: 576px) {
        .og-navbar .navbar-brand span {
          display: none; /* em mobile mostra só o logo */
        }
      }
    </style>

    {% block extra_head %}{% endblock %}
  </head>
  <body>
    <!-- Top bar with login/logout -->
    <nav class="navbar og-navbar">
      <div class="container-lg d-flex align-items-center justify-content-between">
        <a class="navbar-brand d-flex align-items-center gap-2" href="{'#'}">
          <img class="logo" src="{% static 'img/company-logo.png' %}" alt="Company logo">
          <span class="fw-semibold">Console</span>
        </a>

        <ul class="navbar-nav flex-row align-items-center gap-3">
          {% if request.user.is_authenticated %}
            <li class="nav-item">
              <span class="nav-link disabled small text-muted" aria-hidden="true">
                Signed in as <strong>{{ request.user.get_short_name|default:request.user.username|escape }}</strong>
              </span>
            </li>

            <li class="nav-item">
              {# Logout via POST para evitar CSRF/CSRF-like issues #}
              <form method="post" action="{% url 'logout' %}" class="d-inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-link nav-link p-0" style="text-decoration:none;">
                  Sign out
                </button>
              </form>
            </li>
          {% else %}
            <li class="nav-item">
              <a href="{% url 'login' %}" class="btn btn-sm btn-primary px-3 py-1">
                Sign in
              </a>
            </li>
          {% endif %}
        </ul>
      </div>
    </nav>

    <!-- Flash messages -->
    <div class="container-lg mt-3 og-alerts" aria-live="polite" aria-atomic="true">
      {% if messages %}
        {% for message in messages %}
          <div
            class="alert alert-{{ message.tags|default:'info' }} alert-dismissible fade show"
            role="alert"
          >
            {{ message|safe }}{# assumimos que mensagens são inseridas pelo backend e já sanitizadas #}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    </div>

    <!-- Page content -->
    <main class="container-lg og-page">
      {% block content %}{% endblock %}
    </main>

    <!-- Footer simples -->
    <footer class="og-footer py-3">
      <div class="container-lg d-flex flex-wrap justify-content-between align-items-center gap-2">
        <span>© {% now "Y" %} Console</span>
        <span class="text-muted">
          Built with <a href="https://www.djangoproject.com/" target="_blank" rel="noopener noreferrer">Django</a>
          &amp;
          <a href="https://getbootstrap.com/" target="_blank" rel="noopener noreferrer">Bootstrap</a>
        </span>
      </div>
    </footer>

    <!-- Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <script>
      // Auto-fechar alerts depois de alguns segundos
      document.addEventListener("DOMContentLoaded", function () {
        const alerts = document.querySelectorAll(".og-alerts .alert");
        alerts.forEach(function (alertEl) {
          setTimeout(function () {
            if (alertEl.classList.contains("show")) {
              const bsAlert = bootstrap.Alert.getOrCreateInstance(alertEl);
              bsAlert.close();
            }
          }, 6000);
        });
      });
    </script>

    {% block extra_js %}{% endblock %}
  </body>
</html>

{% extends "base.html" %}
{% block title %}Invitation link{% endblock %}

{% block content %}
<div class="mx-auto" style="max-width:520px;">
  <div class="og-card p-4">

    <h1 class="h5 mb-3">User created</h1>

    <p class="text-muted mb-3">
      Email sending is not configured.  
      Copy the password setup link below and send it to the user:
    </p>

    <div class="input-group mb-3">
      <input
        id="resetLink"
        class="form-control"
        value="{{ reset_link }}"
        readonly
        aria-label="Password setup link"
      >
      <button
        type="button"
        class="btn btn-primary"
        id="copyBtn"
        aria-label="Copy link"
      >
        Copy
      </button>
    </div>

    <a href="{% url 'gitea_users' %}" class="btn btn-outline-secondary w-100">Done</a>

    <!-- Toast feedback -->
    <div
      id="copyToast"
      class="toast align-items-center text-bg-success border-0 position-fixed"
      style="bottom: 20px; right: 20px; z-index: 2000;"
      role="alert"
      aria-live="polite"
      aria-atomic="true"
    >
      <div class="d-flex">
        <div class="toast-body">
          Link copied!
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function () {
    const input = document.getElementById("resetLink");
    const copyBtn = document.getElementById("copyBtn");
    const toastEl = document.getElementById("copyToast");
    const toast = bootstrap.Toast.getOrCreateInstance(toastEl);

    // foca automaticamente o campo — útil para admins
    if (input) input.focus();

    copyBtn.addEventListener("click", async function () {
        try {
            await navigator.clipboard.writeText(input.value);
            toast.show();
        } catch (err) {
            console.error("Copy failed:", err);
            alert("Could not copy automatically. Copy manually.");
        }
    });
});
</script>
{% endblock %}
